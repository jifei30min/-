C51 COMPILER V9.54   MAIN                                                                  04/08/2025 20:22:01 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Software\keil5ARM\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Diver) DEBUG OBJECTE
                    -XTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          //Í·ÎÄ¼þÉùÃ÷Çø
   2          #include <STC15F2K60S2.H>//µ¥Æ¬»ú´æ´¢ÇøÍ·ÎÄ¼þ
   3          #include <Init.H>//³õÊ¼»¯µ×²ãÇý¶¯×¨ÓÃÍ·ÎÄ¼þ
   4          #include <Led.H>//Ledµ×²ãÈ¡µ½×¨ÓÃÍ·ÎÄ¼þ
   5          #include <Seg.h>//°´¼üµ×²ãÇý¶¯×¨ÓÃÍ·ÎÄ¼þ
   6          #include <Key.h>//ÊýÂë¹Üµ×²ãÇý¶¯×¨ÓÃÍ·ÎÄ¼þ
   7          #include "iic.h"
   8          
   9          
  10          //ÎÒµÄ´úÂëÖÐS6ÎÞ·¨¹Ø±ÕLEDµÄÔ­ÒòÊÇÒòÎªÎÒÔÚµãÁÁLEDÊ± Ã»ÓÐÍ¨¹ýucLed[]À´¸³Öµ ÎÒÊÇÖ±½Óµ÷ÓÃLEDº¯Êý¸³ÖµµÄ ËùÒÔ¼´±
             -ãÎÒÔÚ¶¨Ê±1µÄÖÕ¶ËÖÐ¸Ä±äÁËucLed[]µÄÖµ Ò²ÎÞ¼ÃÓÚÊÂ
  11          //ËùÒÔ:ËùÓÐLED²Ù×÷¶¼Í¨¹ýucLed[]Êý×é½øÐÐ£¬È·±£×´Ì¬Ò»ÖÂÐÔ
  12          
  13          //ÉùÃ÷±äÁ¿
  14          unsigned char Key_Val,Key_Down,Key_Up,Key_Old;//°´¼üÉ¨Ãè×¨ÓÃ±äÁ¿
  15          unsigned int Key_Slow_Down; //°´¼ü¼õËÙ×¨ÓÃ±äÁ¿10ms
  16          unsigned char Seg_Buf[8] = {1,2,3,4,5,6,7,8}; //ÊýÂë¹ÜÏÔÊ¾Êý¾Ý´æ·ÅÊý×é
  17          unsigned char Seg_Point[8] = {0,0,0,0,0,0,0,0};//ÊýÂë¹ÜÐ¡ÊýµãÊý¾Ý´æ·ÅÊý×é
  18          unsigned char Seg_Pos;//ÊýÂë¹ÜÉ¨Ãè±äÁ¿
  19          unsigned int Seg_Slow_Down; //ÊýÂë¹Ü¼õËÙ×¨ÓÃ±äÁ¿500ms
  20          unsigned char ucLed[8] = {0,0,0,0,0,0,0,0}; //LEDÏÔÊ¾Êý¾Ý´æ·ÅÊý×é
  21          
  22          unsigned char Smg_Mode = 1;//ÊýÂë¹ÜÏÔÊ¾½çÃæ 1ÎªÆµÂÊÏÔÊ¾½çÃæ 2ÎªµçÑ¹ÏÔÊ¾½çÃæ
  23          unsigned int Dat;//ÆµÂÊ
  24          unsigned int Timer1000ms;//¶¨Ê±Æ÷1 1000ms
  25          float UC;//RB2µÄÊä³öµçÑ¹
  26          float DAC_Send;//DACÊä³öµçÑ¹
  27          bit DAC_System = 1;//DACÊä³öÄ£Ê½ÇÐ»»
  28          bit LED_System = 1;//LED¹¦ÄÜÆô¶¯ÇÐ»»
  29          
  30          bit SMG_System = 1;//ÊýÂë¹Ü¹¦ÄÜÇÐ»»
  31          
  32          
  33          
  34          
  35          //°´¼ü´¦Àíº¯Êý
  36          void Key_Proc()
  37          {
  38   1        //Èç¹ûKey_Slow_Down·ÇÁã£¬ifÌõ¼þ³ÉÁ¢£¬Ö´ÐÐreturn;Óï¾ä£¬Key_Proc()»áÍ£Ö¹Ö´ÐÐ£¬²»»áÖ´ÐÐºóÃæµÄKey_Slow_Down =
             - 1;
  39   1        if(Key_Slow_Down) return;
  40   1        
  41   1        //Key_Slow_Down == 0Ê±  Key_Slow_Down±äÎª1
  42   1        Key_Slow_Down = 1;//°´¼ü¼õËÙ³ÌÐò
  43   1        
  44   1        //ÕÕ°á´úÂë
  45   1        Key_Val = Key_Read(); //¶ÁÈ¡°´ÏÂµÄ¼üÂëÖµ
  46   1        
  47   1        Key_Down = Key_Val & (Key_Val ^ Key_Old);//²¶×½ÏÂ½µÑØ //°´¼ü°´ÏÂÄÇÒ»Ë²¼äµÄÖµ
  48   1        
  49   1        Key_Up = ~Key_Val & (Key_Val ^ Key_Old);//²¶×½ÉÏÉýÑØ //°´¼üÌ§ÆðÄÇÒ»Ë²¼äµÄÖµ
  50   1        
  51   1        Key_Old = Key_Val;//¸¨ÖúÉ¨Ãè //°´¼üÒ»Ö±°´ÏÂµÄÊ±ºòµÄÖµ
  52   1        
C51 COMPILER V9.54   MAIN                                                                  04/08/2025 20:22:01 PAGE 2   

  53   1        switch(Key_Down)
  54   1        {
  55   2          case 4:
  56   2            if(++Smg_Mode == 3) Smg_Mode = 1;
  57   2          break;
  58   2          case 5:
  59   2            DAC_System = !DAC_System;
  60   2          break;
  61   2          case 6:
  62   2            LED_System = !LED_System;
  63   2          break;
  64   2          case 7:
  65   2            SMG_System = !SMG_System;
  66   2          break;
  67   2        }
  68   1      }
  69          
  70          //ÐÅÏ¢´¦Àíº¯Êý
  71          void Seg_Proc()
  72          {
  73   1        if(Seg_Slow_Down) return;
  74   1        Seg_Slow_Down = 1;//ÊýÂë¹Ü¼õËÙ³ÌÐò
  75   1        
  76   1        UC = (float)Ad_Read(0X43) / 51.0;
  77   1        if(DAC_System == 1) DAC_Send = 2.0;
  78   1        if(DAC_System == 0) DAC_Send = UC;
  79   1        
  80   1        Da_Send((unsigned char)(DAC_Send * 51.0));
  81   1        
  82   1        
  83   1        switch(Smg_Mode)
  84   1        {
  85   2          case 1:
  86   2            Seg_Buf[0] = 15;
  87   2            Seg_Buf[1] = 17;
  88   2            Seg_Buf[2] = Dat > 99999? (Dat / 100000) % 10 : 17;
  89   2            Seg_Buf[3] = Dat > 9999? (Dat / 10000) % 10 : 17;
  90   2            Seg_Buf[4] = Dat > 999? (Dat / 1000) % 10 : 17;
  91   2            Seg_Buf[5] = Dat > 99? (Dat / 100) % 10 : 17;
  92   2            Seg_Buf[6] = Dat > 9? (Dat / 10) % 10 : 17;
  93   2            Seg_Buf[7] = Dat > 0? Dat % 10 : 17;
  94   2            Seg_Point[5] = 0;
  95   2          break;
  96   2            
  97   2          case 2:
  98   2            Seg_Buf[0] = 19;
  99   2            Seg_Buf[1] = 17;
 100   2            Seg_Buf[2] = 17;
 101   2            Seg_Buf[3] = 17;
 102   2            Seg_Buf[4] = 17;
 103   2            Seg_Buf[5] = (unsigned int)UC;
 104   2            Seg_Buf[6] = (unsigned int)(UC * 10) % 10;
 105   2            Seg_Buf[7] = (unsigned int)(UC * 100) % 10;
 106   2            Seg_Point[5] = 1;
 107   2            
 108   2          break;
 109   2          
 110   2        }
 111   1        
 112   1        
 113   1      }
 114          
C51 COMPILER V9.54   MAIN                                                                  04/08/2025 20:22:01 PAGE 3   

 115          //ÆäËûÏÔÊ¾º¯Êý
 116          void Led_Proc()
 117          {
 118   1        if(Smg_Mode == 2)
 119   1        {
 120   2      //    Led_Disp(0,1);
 121   2          ucLed[0] = 1;
 122   2      //    Led_Disp(1,0);
 123   2          ucLed[1] = 0;
 124   2        }
 125   1        if(Smg_Mode == 1)
 126   1        {
 127   2      //    Led_Disp(0,0);
 128   2          ucLed[0] = 0;
 129   2      //    Led_Disp(1,1);
 130   2          ucLed[1] = 1;
 131   2        }
 132   1        
 133   1        //L3
 134   1        if(UC < 1.5) ucLed[2] = 0;
 135   1        if(UC >= 1.5 && UC < 2.5) ucLed[2] = 1;
 136   1        if(UC >= 2.5 && UC < 3.5) ucLed[2] = 0;
 137   1        if(UC >= 3.5) ucLed[2] = 1;
 138   1        
 139   1        //L4
 140   1        if(Dat < 1000) ucLed[3] = 0;
 141   1        if(Dat >= 1000 && Dat < 5000) ucLed[3] = 1;
 142   1        if(Dat >= 5000 && Dat < 10000) ucLed[3] = 0;
 143   1        if(Dat >= 10000) ucLed[3] = 1; 
 144   1        
 145   1        //L5
 146   1        if(DAC_Send == 2.0) ucLed[4] = 0; 
 147   1        if(DAC_Send == UC) ucLed[4] = 1;  
 148   1        
 149   1      }
 150          
 151          
 152          //¶¨Ê±Æ÷0 ¼ÆÊýÄ£Ê½ 16Î»
 153          void Timer0Init()   //0ºÁÃë@12.000MHz
 154          {
 155   1        AUXR &= 0x7F;   //¶¨Ê±Æ÷Ê±ÖÓ12TÄ£Ê½
 156   1        TMOD &= 0xF0;   //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 157   1        TMOD |= 0x05;   //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 158   1        TL0 = 0x00;   //ÉèÖÃ¶¨Ê±³õÖµ
 159   1        TH0 = 0x00;   //ÉèÖÃ¶¨Ê±³õÖµ
 160   1        TF0 = 0;    //Çå³ýTF0±êÖ¾
 161   1        TR0 = 1;    //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
 162   1      }
 163          
 164          //¶¨Ê±Æ÷1 ¶¨Ê±Ä£Ê½ 16Î»×Ô¶¯ÖØ×°ÔØ 1ms
 165          void Timer1Init()   //1ºÁÃë@12.000MHz
 166          {
 167   1        AUXR |= 0x40;   //¶¨Ê±Æ÷Ê±ÖÓ1TÄ£Ê½
 168   1        TMOD &= 0x0F;   //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 169   1        TL1 = 0x20;   //ÉèÖÃ¶¨Ê±³õÖµ
 170   1        TH1 = 0xD1;   //ÉèÖÃ¶¨Ê±³õÖµ
 171   1        TF1 = 0;    //Çå³ýTF1±êÖ¾
 172   1        TR1 = 1;    //¶¨Ê±Æ÷1¿ªÊ¼¼ÆÊ±
 173   1        
 174   1        ET1 = 1;
 175   1        EA = 1;
 176   1      }
C51 COMPILER V9.54   MAIN                                                                  04/08/2025 20:22:01 PAGE 4   

 177          
 178          
 179          //¶¨Ê±Æ÷1ÖÐ¶Ï·þÎñº¯Êý
 180          void Timer1Service() interrupt 3
 181          {
 182   1        //×Ô¶¯ÖØ×°ÔØ ²»ÐèÒª¸³³õÖµ
 183   1        
 184   1        Key_Slow_Down++;
 185   1        if(Key_Slow_Down == 10) Key_Slow_Down=0; //if(++Key_Slow_Down == 10)Key_Slow_Down=0;
 186   1        
 187   1        Seg_Slow_Down++;
 188   1        if(Seg_Slow_Down == 500) Seg_Slow_Down=0;//if(++Seg_Slow_Down == 500) Seg_Slow_Down=0;
 189   1        
 190   1        if(++Seg_Pos == 8) Seg_Pos = 0;
 191   1        if(SMG_System == 1)
 192   1        {
 193   2          Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
 194   2        }else{
 195   2          Seg_Disp(Seg_Pos,17,0);
 196   2        }
 197   1          
 198   1        if(LED_System == 1)
 199   1        {
 200   2          Led_Disp(Seg_Pos,ucLed[Seg_Pos]);
 201   2        }else
 202   1        {
 203   2          Led_Disp(Seg_Pos,0);
 204   2        }
 205   1        
 206   1        if(++Timer1000ms == 1000)
 207   1        {
 208   2          Timer1000ms = 0;
 209   2          Dat = (TH0 << 8) | TL0;
 210   2          TL0 = 0x00;   //ÉèÖÃ¼ÆÊý³õÖµ
 211   2          TH0 = 0x00;   //ÉèÖÃ¼ÆÊý³õÖµ
 212   2        }
 213   1      }
 214          
 215          //Mainº¯Êý
 216          void main()
 217          {
 218   1        System_Init();
 219   1        Timer0Init();
 220   1        Timer1Init();
 221   1        while(1)
 222   1        {
 223   2          Key_Proc();
 224   2          Seg_Proc();
 225   2          Led_Proc();
 226   2        }
 227   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1038    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     46    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.54   MAIN                                                                  04/08/2025 20:22:01 PAGE 5   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
